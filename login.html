<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">
    <title>Login</title>
</head>
<body>
    
    <div class="wrapper">
        
        <!-- SIGN UP -->
        <div class="form-container sign-up">
            <form id="form-register">
                <h2>Registre-se</h2>

                <div class="form-group">
                    <input type="text" id="reg-nome" required>
                    <i class="fas fa-user"></i>
                    <label for="reg-nome">Seu nome</label>
                </div>

                <div class="form-group">
                    <input type="email" id="reg-email" required>
                    <i class="fas fa-at"></i>
                    <label for="reg-email">Email</label>
                </div>

                <div class="form-group">
                    <input type="password" id="reg-senha" required>
                    <i class="fas fa-lock"></i>
                    <label for="reg-senha">Senha</label>
                </div>

                <div class="user-type-buttons three-buttons" id="type-buttons-container">
                  <button type="button" class="type-btn selected" data-tipo="aluno">Paciente</button>
                <button type="button" class="type-btn" data-tipo="nutricionista">Nutricionista</button>
                  <button type="button" class="type-btn" data-tipo="treinador">treinador</button>
                </div>

                <input type="hidden" id="reg-type" value="aluno">

                <button type="submit" class="btn">Registrar</button>

                <div class="link">
                    <p>Você já tem uma conta? <a href="#" class="signin-link">Entrar</a></p>
                </div>
            </form>
        </div>

        <!-- LOGIN -->
        <div class="form-container sign-in">
            <form id="form-login">
                <h2>Login</h2>

                <div class="form-group">
                    <input type="email" id="login-email" required>
                    <i class="fas fa-user"></i>
                    <label for="login-email">Email</label>
                </div>

                <div class="form-group">
                    <input type="password" id="login-senha" required>
                    <i class="fas fa-lock"></i>
                    <label for="login-senha">Senha</label>
                </div>

                <div class="forgot-pass">
                    <a href="#">Esqueceu a senha?</a>
                </div>

                <button type="submit" class="btn">Entrar</button>

                <div class="link">
                    <p>Não tem uma conta? <a href="#" class="signup-link">Registre-se</a></p>
                </div>
            </form>
        </div> 

    </div>

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <script src="login.js"></script>

 <script>

document.addEventListener('DOMContentLoaded', function() {
    
    
    
    // --- 1. LÓGICA DE ANIMAÇÃO (TROCA ENTRE LOGIN E REGISTRO) ---
    const wrapper = document.querySelector('.wrapper');
    
    const signUpLink = document.querySelector('.signup-link');
    const signInLink = document.querySelector('.signin-link');

    signUpLink.addEventListener('click', (e) => {
        e.preventDefault();
        wrapper.classList.add('animate-signIn');
        wrapper.classList.add('animate-signUp');
    });

    signInLink.addEventListener('click', (e) => {
        e.preventDefault();
        wrapper.classList.add('animate-signIn');
        wrapper.classList.remove('animate-signUp');
    });

    // --- 2. LÓGICA DE SELEÇÃO DO TIPO DE USUÁRIO ---
    const typeButtons = document.querySelectorAll('.type-btn');
    const hiddenTypeInput = document.getElementById('reg-type');

    typeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove classe selected de todos
            typeButtons.forEach(b => b.classList.remove('selected'));
            // Adiciona no clicado
            this.classList.add('selected');
            
            // Atualiza o input escondido com o valor 'aluno' ou 'treinador'
            // Nota: Nutricionista e Personal serão tratados como 'treinador' no banco
            hiddenTypeInput.value = this.getAttribute('data-tipo');
        });
    });

    // --- 3. CONEXÃO COM O PHP (FETCH API) ---

   
    // A. LOGIN
    const formLogin = document.getElementById('form-login');
    formLogin.addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData();
        formData.append('email', document.getElementById('login-email').value);
        formData.append('senha', document.getElementById('login-senha').value);

        fetch('php/login.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                
                // --- AQUI ESTAVA O ERRO ---
                // Agora verificamos se é treinador OU (||) nutricionista
                if (data.tipo === 'treinador' || data.tipo === 'nutricionista') {
                    window.location.href = 'painel_treinador.php';
                } else {
                    window.location.href = 'painel_aluno.php';
                }
                
            } else {
                alert('Erro: ' + data.message);
            }
        })
        .catch(error => console.error('Erro no login:', error));
    });

    // B. REGISTRO
    const formRegister = document.getElementById('form-register');
    formRegister.addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData();
        formData.append('nome', document.getElementById('reg-nome').value);
        formData.append('email', document.getElementById('reg-email').value);
        formData.append('senha', document.getElementById('reg-senha').value);
        
        // Pega o valor do botão selecionado (aluno ou treinador)
        formData.append('tipo', hiddenTypeInput.value); 
        
        // Envia para a pasta php/registrar.php (PRECISAMOS ATUALIZAR ESSE PHP PARA ACEITAR 'TIPO')e ja ta atualizado galera nao precisa mudar mais
        fetch('php/registrar.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            if (data.status === 'success') {
                // ANTES: Redirecionava para os painéis
                // AGORA: Manda de volta para a Home, mas agora logado
                window.location.href = 'index.php'; 
            } else {
                alert('Erro: ' + data.message);
            }
        })
        .catch(error => console.error('Erro no registro:', error));
    });

});
</script>


</body>
</html>
